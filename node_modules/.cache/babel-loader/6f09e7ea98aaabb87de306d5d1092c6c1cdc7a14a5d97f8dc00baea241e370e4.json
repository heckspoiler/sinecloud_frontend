{"ast":null,"code":"import _toConsumableArray from\"/Users/Carlito/Desktop/repos/sinecloud_frontend/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"/Users/Carlito/Desktop/repos/sinecloud_frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState,useEffect,useRef,useTransition}from\"react\";import ReactPlayer from\"react-player\";import\"./Feed.css\";import faultradio from\"../Home/SecondSection/Logos/radio-stations/fault-radio.png\";import kioskradio from\"../Home/SecondSection/Logos/radio-stations/kiosk-radio.png\";import nts from\"../Home/SecondSection/Logos/radio-stations/nts.png\";import thelotradio from\"../Home/SecondSection/Logos/radio-stations/the-lot-radio.png\";import trnstnradio from\"../Home/SecondSection/Logos/radio-stations/trnstn-radio.png\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var getLogoByUser=function getLogoByUser(user){switch(user){case\"faultradio\":return faultradio;case\"kioskradio\":return kioskradio;case\"nts-latest\":return nts;case\"thelotradio\":return thelotradio;case\"trnstnradio\":return trnstnradio;default:return null;}};var Feed=function Feed(){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),usersData=_useState2[0],setUsersData=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),currentRadioStation=_useState4[0],setCurrentRadioStation=_useState4[1];var _useState5=useState(0),_useState6=_slicedToArray(_useState5,2),offset=_useState6[0],setOffset=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isLoading=_useState8[0],setIsLoading=_useState8[1];var elementsRef=useRef([]);var limit=5;var lastTrackRef=useRef();var _useTransition=useTransition({timeoutMs:3000}),_useTransition2=_slicedToArray(_useTransition,2),isPending=_useTransition2[0],startTransition=_useTransition2[1];var fetchTracks=function fetchTracks(){if(isLoading){return;}startTransition(function(){setIsLoading(true);fetch(\"https://sinecloud-server.onrender.com/api/soundcloud?offset=\".concat(offset,\"&limit=\").concat(limit)).then(function(response){if(!response.ok)throw new Error(\"Request failed with status \"+response.status);return response.json();}).then(function(data){console.log(data);setUsersData(function(oldData){return[].concat(_toConsumableArray(oldData),_toConsumableArray(data.message));});setOffset(function(oldOffset){return oldOffset+limit;});setIsLoading(false);}).catch(function(error){console.error(error);setIsLoading(false);});});};useEffect(function(){fetchTracks();},[]);useEffect(function(){var observer=new IntersectionObserver(function(entries){entries.forEach(function(entry){if(entry.isIntersecting){setCurrentRadioStation(entry.target.dataset.user);}});},{threshold:0.5});elementsRef.current.forEach(function(element){if(element){observer.observe(element);}});return function(){elementsRef.current.forEach(function(element){if(element){observer.unobserve(element);}});};},[usersData]);useEffect(function(){var observer=new IntersectionObserver(function(entries){entries.forEach(function(entry){if(entry.isIntersecting&&!isLoading){fetchTracks();// Fetch more tracks when last track is in view\n}});},{threshold:0.2});if(lastTrackRef.current){observer.observe(lastTrackRef.current);}return function(){if(lastTrackRef.current){observer.unobserve(lastTrackRef.current);}};},[usersData,isLoading]);return/*#__PURE__*/_jsxs(\"div\",{className:\"feed\",children:[/*#__PURE__*/_jsx(\"h1\",{children:isPending?\"Loading...\":null}),/*#__PURE__*/_jsxs(\"h1\",{children:[\"Feed me \",/*#__PURE__*/_jsx(\"br\",{className:\"break-title\"}),\"new music\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"rotate-div\"}),/*#__PURE__*/_jsx(\"div\",{className:\"img-container\",children:usersData.length>0&&/*#__PURE__*/_jsx(\"img\",{src:getLogoByUser(currentRadioStation),className:\"radio-station-img\",alt:currentRadioStation})}),usersData.map(function(data,index){var isLastItem=index===usersData.length-1;return/*#__PURE__*/_jsx(\"div\",{className:\"feed-player-container\",\"data-user\":data.user,ref:function ref(element){elementsRef.current.push(element);if(isLastItem)lastTrackRef.current=element;},children:/*#__PURE__*/_jsx(ReactPlayer,{url:data.track.url,className:\"react-player\"})},index);})]});};export default Feed;","map":{"version":3,"names":["React","useState","useEffect","useRef","useTransition","ReactPlayer","faultradio","kioskradio","nts","thelotradio","trnstnradio","jsx","_jsx","jsxs","_jsxs","getLogoByUser","user","Feed","_useState","_useState2","_slicedToArray","usersData","setUsersData","_useState3","_useState4","currentRadioStation","setCurrentRadioStation","_useState5","_useState6","offset","setOffset","_useState7","_useState8","isLoading","setIsLoading","elementsRef","limit","lastTrackRef","_useTransition","timeoutMs","_useTransition2","isPending","startTransition","fetchTracks","fetch","concat","then","response","ok","Error","status","json","data","console","log","oldData","_toConsumableArray","message","oldOffset","catch","error","observer","IntersectionObserver","entries","forEach","entry","isIntersecting","target","dataset","threshold","current","element","observe","unobserve","className","children","length","src","alt","map","index","isLastItem","ref","push","url","track"],"sources":["/Users/Carlito/Desktop/repos/sinecloud_frontend/src/Components/Feed/Feed.js"],"sourcesContent":["import React, { useState, useEffect, useRef, useTransition } from \"react\";\nimport ReactPlayer from \"react-player\";\nimport \"./Feed.css\";\nimport faultradio from \"../Home/SecondSection/Logos/radio-stations/fault-radio.png\";\nimport kioskradio from \"../Home/SecondSection/Logos/radio-stations/kiosk-radio.png\";\nimport nts from \"../Home/SecondSection/Logos/radio-stations/nts.png\";\nimport thelotradio from \"../Home/SecondSection/Logos/radio-stations/the-lot-radio.png\";\nimport trnstnradio from \"../Home/SecondSection/Logos/radio-stations/trnstn-radio.png\";\n\nconst getLogoByUser = (user) => {\n  switch (user) {\n    case \"faultradio\":\n      return faultradio;\n    case \"kioskradio\":\n      return kioskradio;\n    case \"nts-latest\":\n      return nts;\n    case \"thelotradio\":\n      return thelotradio;\n    case \"trnstnradio\":\n      return trnstnradio;\n    default:\n      return null;\n  }\n};\n\nconst Feed = () => {\n  const [usersData, setUsersData] = useState([]);\n  const [currentRadioStation, setCurrentRadioStation] = useState(\"\");\n  const [offset, setOffset] = useState(0);\n  const [isLoading, setIsLoading] = useState(false);\n  const elementsRef = useRef([]);\n  const limit = 5;\n  const lastTrackRef = useRef();\n\n  const [isPending, startTransition] = useTransition({\n    timeoutMs: 3000,\n  });\n\n  const fetchTracks = () => {\n    if (isLoading) {\n      return;\n    }\n    startTransition(() => {\n      setIsLoading(true);\n      fetch(\n        `https://sinecloud-server.onrender.com/api/soundcloud?offset=${offset}&limit=${limit}`\n      )\n        .then((response) => {\n          if (!response.ok)\n            throw new Error(\"Request failed with status \" + response.status);\n          return response.json();\n        })\n        .then((data) => {\n          console.log(data);\n          setUsersData((oldData) => [...oldData, ...data.message]);\n          setOffset((oldOffset) => oldOffset + limit);\n          setIsLoading(false);\n        })\n        .catch((error) => {\n          console.error(error);\n          setIsLoading(false);\n        });\n    });\n  };\n\n  useEffect(() => {\n    fetchTracks();\n  }, []);\n\n  useEffect(() => {\n    const observer = new IntersectionObserver(\n      (entries) => {\n        entries.forEach((entry) => {\n          if (entry.isIntersecting) {\n            setCurrentRadioStation(entry.target.dataset.user);\n          }\n        });\n      },\n      { threshold: 0.5 }\n    );\n\n    elementsRef.current.forEach((element) => {\n      if (element) {\n        observer.observe(element);\n      }\n    });\n\n    return () => {\n      elementsRef.current.forEach((element) => {\n        if (element) {\n          observer.unobserve(element);\n        }\n      });\n    };\n  }, [usersData]);\n\n  useEffect(() => {\n    const observer = new IntersectionObserver(\n      (entries) => {\n        entries.forEach((entry) => {\n          if (entry.isIntersecting && !isLoading) {\n            fetchTracks(); // Fetch more tracks when last track is in view\n          }\n        });\n      },\n      { threshold: 0.2 }\n    );\n\n    if (lastTrackRef.current) {\n      observer.observe(lastTrackRef.current);\n    }\n\n    return () => {\n      if (lastTrackRef.current) {\n        observer.unobserve(lastTrackRef.current);\n      }\n    };\n  }, [usersData, isLoading]);\n\n  return (\n    <div className=\"feed\">\n      <h1>{isPending ? \"Loading...\" : null}</h1>\n      <h1>\n        Feed me <br className=\"break-title\" />\n        new music\n      </h1>\n      <div className=\"rotate-div\"></div>\n      <div className=\"img-container\">\n        {usersData.length > 0 && (\n          <img\n            src={getLogoByUser(currentRadioStation)}\n            className=\"radio-station-img\"\n            alt={currentRadioStation}\n          />\n        )}\n      </div>\n\n      {usersData.map((data, index) => {\n        const isLastItem = index === usersData.length - 1;\n        return (\n          <div\n            className=\"feed-player-container\"\n            data-user={data.user}\n            ref={(element) => {\n              elementsRef.current.push(element);\n              if (isLastItem) lastTrackRef.current = element;\n            }}\n            key={index}\n          >\n            <ReactPlayer url={data.track.url} className=\"react-player\" />\n          </div>\n        );\n      })}\n    </div>\n  );\n};\n\nexport default Feed;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}